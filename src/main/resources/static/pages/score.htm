<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classes</title>
    <style>
        table,
        th,
        td {
            border: 1px solid rgb(252, 105, 105);
            background-color: aliceblue;
        }

        th,
        td {
            padding: 10px;
        }

        table {
            margin: auto;
        }

        th {
            border: 2px dashed rgb(144, 250, 144);
        }
    </style>
</head>

<body>
    <h1>Score</h1>
    <p>
        <a href="/index.htm">Home Page</a>
    </p>

    <p>
        limit: <input id="limit" type="number" />
        offset: <input id="offset" type="number" />
        <button onclick="sendRequest()">获取</button>
    </p>

    <p>
        <a>插入数据</a>
    </p>
    <p>
        学生学号: <input id="studentId" type="number" />
        语文成绩: <input id="chinese" type="number" />
        数学成绩: <input id="math" type="number" />
        英语成绩: <input id="english" type="number" />
        <button onclick="sendInsert()">确认插入</button>
    </p>

    <table>
        <thead>
            <tr>
                <th>Id</th>
                <th>学生学号</th>
                <th>语文成绩</th>
                <th>数学成绩</th>
                <th>英语成绩</th>
            </tr>
        </thead>
        <tbody id="table">
        </tbody>
    </table>

    <script>
        const table = document.getElementById('table')
        const limitInput = document.getElementById('limit')
        const offsetInput = document.getElementById('offset')
        const studentIdInput = document.getElementById('studentId')
        const chineseInput = document.getElementById('chinese')
        const mathInput = document.getElementById('math')
        const englishInput = document.getElementById('english')

        function addRow(record) {
            let recordHtml = ''
            recordHtml += '<tr>'
            recordHtml += '<td>' + record.id + '</td>'
            recordHtml += '<td>' + record.studentId + '</td>'
            recordHtml += '<td>' + record.chinese + '</td>'
            recordHtml += '<td>' + record.math + '</td>'
            recordHtml += '<td>' + record.english + '</td>'
            recordHtml += '</tr>'
            table.innerHTML += recordHtml
        }

        async function getScore(limit, offset) {
            const url = 'http://localhost:8080/score/list?limit=' + limit + '&offset=' + offset
            console.log('请求地址：', url)
            const data = await fetch(url).then(function getRequestFromAPI(response) {
                return response.json()
            })
            return data
        }


        async function insertScore(studentId, chinese, math, english) {
            const url = 'http://localhost:8080/score'
            console.log('请求地址：', url)

            const data = await fetch(url, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({  //这里是post请求的请求体
                    "studentId": studentId,
                    "chinese": chinese,
                    "math": math,
                    "english": english
                })
            })
             return data
           
        }

        async function sendInsert() {
            const studentId = studentIdInput.value
            const chinese = chineseInput.value
            const math = mathInput.value
            const english = englishInput.value
            const data = await insertScore(studentId,chinese,math,english)
            console.log('插入数据', data)

            table.innerHTML = ''
            for (let i = 0; i < data.length; i++) {
                addRow(data[i])
            }
        }


        async function sendRequest() {
            const limit = limitInput.value
            const offset = offsetInput.value
            const data = await getScore(limit, offset)
            console.log('请求返回值：', data)

            table.innerHTML = ''
            for (let i = 0; i < data.length; i++) {
                addRow(data[i])
            }
        }


    </script>
</body>

</html>